<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="refresh" content="15">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agronomists</title>
  <link href="agronomist.jpg" rel="icon"/>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap");
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --app-bg-dark: rgba(1, 8, 31, 0.9);
      --app-bg-light: rgba(21, 28, 50, 0.8);
      --app-logo: #7dff99;
      --nav-link: #b0b8cc;
      --nav-link-active: #fff;
      --list-item-hover: rgba(12, 22, 53, 0.95);
      --main-color: #fff;
      --secondary-color: #d1d8e0;
      --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
      --glass-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
      --glass-border: 1px solid rgba(255, 255, 255, 0.15);
      --result-bg: linear-gradient(135deg, rgba(125, 255, 153, 0.2), rgba(0, 207, 222, 0.2));
    }

    body {
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #158b4e 0%, #040f32 100%);
      display: flex;
      flex-direction: column;
    }

    /* Navigation Bar */
    .nav-bar {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border-bottom: var(--glass-border);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--glass-shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-title {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--app-logo);
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .nav-title svg { stroke: var(--app-logo); }

    .nav-center {
      display: flex;
      gap: 20px;
    }

    .nav-tab {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--nav-link);
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      padding: 8px 15px;
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .nav-tab:hover, .nav-tab.active {
      color: var(--nav-link-active);
      background: rgba(125, 255, 153, 0.1);
    }

    .nav-tab svg { stroke: currentColor; }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .device-id {
      color: var(--secondary-color);
      font-size: 12px;
      font-weight: 400;
      padding: 6px 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      border: var(--glass-border);
    }

    .language-selector select {
      padding: 6px 10px;
      background: var(--glass-bg);
      color: var(--main-color);
      border: var(--glass-border);
      border-radius: 6px;
      backdrop-filter: blur(8px);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-menu-toggle {
      display: none;
      background: var(--glass-bg);
      border: none;
      padding: 8px;
      border-radius: 6px;
      color: var(--main-color);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .app-container {
      flex: 1;
      width: 100%;
      display: flex;
      flex-direction: column;
      max-width: 1700px;
      margin: 0 auto;
      padding: 15px;
    }

    .app-main {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: var(--app-bg-light);
      backdrop-filter: blur(8px);
      border-radius: 12px;
    }

    .app-right {
      flex-basis: 320px;
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      height: 100%;
      padding: 60px 0 20px;
      display: flex;
      flex-direction: column;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      transform: translateX(100%);
      position: fixed;
      top: 0;
      right: 0;
      z-index: 200;
      border-left: var(--glass-border);
      box-shadow: var(--glass-shadow);
      border-radius: 16px 0 0 16px;
      width: 100%;
      max-width: 360px;
    }
    .app-right.show { transform: translateX(0); }

    .app-logo {
      display: flex;
      align-items: center;
      color: var(--app-logo);
      padding: 0 25px;
      gap: 15px;
      border-bottom: 1px solid var(--glass-border);
      padding-bottom: 15px;
      margin-bottom: 15px;
    }
    .app-logo span {
      color: var(--main-color);
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .main-header-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .main-header-line h1 {
      color: var(--main-color);
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    .chart-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }
    .chart-row.three .chart-container-wrapper {
      flex: 1 1 calc(33.33% - 20px);
      min-width: 280px;
      max-width: calc(33.33% - 20px);
    }
    .chart-row.two .big {
      flex: 1 1 60%;
      min-width: 300px;
      max-width: 65%;
    }
    .chart-row.two .small {
      flex: 1 1 35%;
      min-width: 280px;
      max-width: 35%;
    }

    .chart-container {
      width: 100%;
      border-radius: 10px;
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: var(--glass-border);
      box-shadow: var(--glass-shadow);
      transition: all 0.3s ease;
    }
    .chart-container:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0, 0, 0, 0.25); }

    .chart-info-wrapper { flex: 1 1 60%; display: flex; align-items: center; gap: 10px; }
    .chart-info-wrapper h2 {
      color: var(--secondary-color);
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      margin: 0 0 10px 0;
      letter-spacing: 0.8px;
    }
    .chart-info-wrapper span {
      color: var(--main-color);
      font-size: 20px;
      font-weight: 500;
    }
    .chart-info-wrapper img { width: 50px; height: 50px; }

    .chart-svg { flex: 0 0 100px; }
    .circle-bg { fill: none; stroke: #e0e0e0; stroke-width: 1.5; }
    .circle { fill: none; stroke-width: 2.2; stroke-linecap: round; animation: progress 1s ease-out forwards; }
    .circular-chart.orange .circle { stroke: #ff9f00; }
    .circular-chart.blue .circle { stroke: #00cfde; }
    .circular-chart.pink .circle { stroke: #7dff99; }
    .circular-chart.green .circle { stroke: #34c759; }
    .circular-chart.purple .circle { stroke: #9c27b0; }
    .percentage { fill: #fff; font-size: 0.6em; text-anchor: middle; font-weight: 500; }
    @keyframes progress { 0% { stroke-dasharray: 0 100; } }

    .recommendations-section {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .recommendation-card {
      flex: 1;
      min-width: 280px;
      padding: 20px;
      background: var(--result-bg);
      backdrop-filter: blur(15px);
      border-radius: 10px;
      border: var(--glass-border);
      box-shadow: var(--glass-shadow);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .recommendation-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .recommendation-card img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 2px solid var(--glass-border);
    }

    .recommendation-card h2 {
      color: var(--secondary-color);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 8px;
    }

    .recommendation-card span {
      color: var(--main-color);
      font-size: 18px;
      font-weight: 600;
    }

    .open-right-area, #generate-report-btn {
      display: flex;
      justify-content: center;
      align-items: center;
      border: none;
      background: var(--glass-bg);
      border-radius: 6px;
      height: 36px;
      width: 36px;
      color: var(--main-color);
      backdrop-filter: blur(8px);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .open-right-area:hover, #generate-report-btn:hover { background: var(--list-item-hover); transform: scale(1.05); }

    #generate-report-btn {
      width: auto;
      padding: 0 12px;
      gap: 6px;
    }

    .profile-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0 25px;
      border-bottom: 1px solid var(--glass-border);
      padding-bottom: 20px;
      margin-bottom: 20px;
    }
    .profile-photo-wrapper {
      width: 80px;
      height: 80px;
      overflow: hidden;
      border-radius: 50%;
      margin-bottom: 15px;
      border: 2px solid var(--glass-border);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .profile-photo-wrapper img { width: 100%; height: 100%; object-fit: cover; }

    .close-right {
      position: absolute;
      top: 15px;
      right: 15px;
      border: none;
      background: var(--glass-bg);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      color: var(--main-color);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 210;
      cursor: pointer;
    }
    .close-right:hover { background: var(--list-item-hover); transform: scale(1.1); }

    .w_f { color: var(--secondary-color); font-size: 12px; line-height: 1.6; }
    .h_f { color: var(--main-color); font-size: 14px; margin-bottom: 10px; font-weight: 500; }
    .h1_f { color: var(--main-color); font-size: 12px; margin-bottom: 8px; }

    .manual-toggle {
      display: flex;
      justify-content: center;
      align-items: center;
      border: none;
      background: var(--glass-bg);
      border-radius: 6px;
      height: 36px;
      width: 36px;
      margin: 20px auto;
      color: var(--main-color);
      backdrop-filter: blur(8px);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .manual-toggle:hover { background: var(--list-item-hover); transform: scale(1.05); }

    .manual-content {
      display: none;
      padding: 0 25px;
      overflow-y: auto;
      flex: 1;
    }
    .manual-content.show { display: block; }

    .manual-step {
      margin-bottom: 20px;
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 8px;
      border: var(--glass-border);
      transition: all 0.3s ease;
    }
    .manual-step:hover { background: rgba(255, 255, 255, 0.1); transform: translateY(-3px); }
    .manual-step h3 { color: var(--main-color); font-size: 14px; margin-bottom: 10px; font-weight: 500; }
    .manual-step p { color: var(--secondary-color); font-size: 12px; line-height: 1.6; }
    .manual-step img { width: 100%; max-width: 200px; height: auto; border-radius: 8px; margin-top: 10px; border: var(--glass-border); }

    /* PDF Modal */
    .pdf-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .pdf-modal.show { display: flex; }

    .pdf-container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      position: relative;
    }

    .pdf-header {
      text-align: center;
      margin-bottom: 20px;
      border-bottom: 2px solid #158b4e;
      padding-bottom: 15px;
    }
    .pdf-header h1 { color: #158b4e; font-size: 28px; margin: 0; }
    .pdf-header p { color: #555; font-size: 14px; }

    .pdf-section { margin-bottom: 25px; }
    .pdf-section h3 { color: #158b4e; font-size: 18px; margin-bottom: 12px; border-left: 4px solid #7dff99; padding-left: 10px; }
    .pdf-row { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
    .pdf-item { flex: 1; min-width: 200px; display: flex; align-items: center; gap: 10px; }
    .pdf-item img { width: 40px; height: 40px; }
    .pdf-item span { font-weight: 600; color: #333; }
    .pdf-item small { color: #777; font-size: 11px; }

    .download-btn {
      display: block;
      margin: 20px auto 0;
      padding: 12px 30px;
      background: #158b4e;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    .download-btn:hover { background: #0d6b3a; }

    .close-pdf {
      position: absolute;
      top: 15px;
      right: 20px;
      background: #ddd;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
    }

    @media screen and (max-width: 1024px) {
      .app-right { max-width: 80%; }
      .chart-row.three .chart-container-wrapper { flex: 1 1 calc(50% - 20px); max-width: calc(50% - 20px); }
      .chart-row.two .big { flex: 1 1 100%; max-width: 100%; }
      .chart-row.two .small { flex: 1 1 100%; max-width: 100%; }
    }

    @media screen and (max-width: 768px) {
      .nav-bar { flex-wrap: wrap; padding: 10px 15px; }
      .nav-center { display: none; flex-direction: column; position: absolute; top: 100%; left: 0; width: 100%; background: var(--glass-bg); padding: 15px; border-bottom: var(--glass-border); }
      .nav-center.show { display: flex; }
      .nav-menu-toggle { display: block; }
      .app-main { padding: 15px; }
      .app-right { max-width: 90%; padding-top: 50px; }
      .main-header-line h1 { font-size: 20px; }
      .chart-container { flex-direction: column; align-items: flex-start; padding: 15px; }
      .chart-svg { margin-top: 10px; }
      .recommendations-section { flex-direction: column; }
    }

    @media screen and (max-width: 480px) {
      .nav-title { font-size: 18px; }
      .chart-info-wrapper span { font-size: 18px; }
      .chart-info-wrapper img { width: 40px; height: 40px; }
      .chart-svg { flex: 0 0 80px; }
      .recommendation-card img { width: 40px; height: 40px; }
      .profile-photo-wrapper { width: 60px; height: 60px; }
    }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <div class="nav-bar">
    <div class="nav-title">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span data-translate="Agronomists">Agronomists</span>
    </div>
    <div class="nav-center">
      <div class="nav-tab active"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="9" y1="3" x2="9" y2="21"/></svg><span data-translate="Dashboard">Dashboard</span></div>
      <div class="nav-tab"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg><span data-translate="Map">Map</span></div>
      <div class="nav-tab"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg><span data-translate="Reports">Reports</span></div>
    </div>
    <div class="nav-right">
      <div class="device-id" id="device-id">PRODUCT ID: Loading...</div>
      <div class="language-selector">
        <select id="language">
          <option value="en">English</option>
          <option value="ta">Tamil</option>
          <option value="hi">Hindi</option>
        </select>
      </div>
      <button class="nav-menu-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="app-container">
    <div class="app-main">
      <div class="main-header-line">
        <h1 data-translate="Agronomist Dashboard">Agronomist Dashboard</h1>
        <div class="action-buttons">
          <button class="open-right-area">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          </button>
          <!-- GENERATE REPORT BUTTON -->
          <button id="generate-report-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
            <span style="font-size:12px;">Generate Report</span>
          </button>
        </div>
      </div>

      <!-- SOIL PARAMETERS -->
      <div class="chart-row three">
        <!-- Moisture -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="moisture.png" alt="Moisture">
              <div><h2 data-translate="Moisture">Moisture</h2><span id="moisture-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart pink">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="moisture-percentage">0</text>
              </svg>
            </div>
          </div>
        </div>

        <!-- Temperature -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="temperature.png" alt="Temperature">
              <div><h2 data-translate="Temperature">Temperature</h2><span id="temperature-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart blue">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="temperature-percentage">0</text>
              </svg>
            </div>
          </div>
        </div>

        <!-- EC -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="conductivity.png" alt="EC">
              <div><h2 data-translate="Electrical Conductivity">Electrical Conductivity</h2><span id="ec-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart orange">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="ec-percentage">0</text>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-row three">
        <!-- pH -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="ph.png" alt="pH">
              <div><h2 data-translate="pH Content">pH Content</h2><span id="ph-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart pink">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="ph-percentage">0</text>
              </svg>
            </div>
          </div>
        </div>

        <!-- Nitrogen -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="nitrogen.png" alt="Nitrogen">
              <div><h2 data-translate="Nitrogen">Nitrogen</h2><span id="nitrogen-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart blue">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="nitrogen-percentage">0</text>
              </svg>
            </div>
          </div>
        </div>

        <!-- Phosphorus -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="phosphorus.png" alt="Phosphorus">
              <div><h2 data-translate="Phosphorus">Phosphorus</h2><span id="phosphorus-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart orange">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="phosphorus-percentage">0</text>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-row three">
        <!-- Potassium -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="potassium.png" alt="Potassium">
              <div><h2 data-translate="Potassium">Potassium</h2><span id="potassium-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart pink">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="potassium-percentage">0</text>
              </svg>
            </div>
          </div>
        </div>

        <!-- SOC -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="SOC.png" alt="SOC">
              <div><h2 data-translate="Soil Organic Carbon">Soil Organic Carbon</h2><span id="soc-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart green">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="soc-percentage">0</text>
              </svg>
            </div>
          </div>
        </div>

        <!-- Texture -->
        <div class="chart-container-wrapper">
          <div class="chart-container">
            <div class="chart-info-wrapper">
              <img src="texture.png" alt="Texture">
              <div><h2 data-translate="Soil Texture">Soil Texture</h2><span id="texture-value">Loading...</span></div>
            </div>
            <div class="chart-svg">
              <svg viewBox="0 0 36 36" class="circular-chart purple">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <path class="circle" stroke-dasharray="0,100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                <text x="18" y="20.35" class="percentage" id="texture-percentage">-</text>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- RECOMMENDATIONS -->
      <div class="recommendations-section">
        <div class="recommendation-card">
          <img src="crop.png" alt="Crop">
          <div><h2 data-translate="Recommended Crop">Recommended Crop</h2><span id="recommended-crop">Loading...</span></div>
        </div>
        <div class="recommendation-card">
          <img src="fertilizer.png" alt="Fertilizer">
          <div><h2 data-translate="Recommended Fertilizer">Recommended Fertilizer</h2><span id="recommended-fertilizer">Loading...</span></div>
        </div>
      </div>

      <!-- WEATHER + MAP -->
      <div class="chart-row two">
        <div class="chart-container-wrapper small">
          <div class="chart-container">
            <div class="chart-container-header"><h2 class="h_f" data-translate="Weather Information">Weather Information</h2></div>
            <div id="location" class="h1_f">Locating...</div>
            <div class="weather-info" id="weather"></div>
          </div>
        </div>
        <div class="chart-container-wrapper big" style="height:300px;border-radius:2em;">
          <gmp-map center="11.5390,79.4794" zoom="10" map-id="DEMO_MAP_ID" style="height:100%;width:100%;border-radius:2em;"></gmp-map>
        </div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="app-right">
      <button class="close-right">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
      <div class="app-logo">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
        <span data-translate="Agronomists">Agronomists</span>
      </div>
      <div class="profile-box">
        <div class="profile-photo-wrapper"><img src="agronomist.jpg" alt="product"></div>
        <p class="profile-subtext" data-translate="Device Name">Device Name</p>
      </div>
      <button class="manual-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 6h10v12H2V6z"/><path d="M12 12h10v6H12z"/><path d="M12 6h6v4h-6z"/></svg>
      </button>
      <div class="manual-content">
        <div class="manual-step"><h3 data-translate="STEP I">STEP I: Setup Device</h3><p>Connect the device to power and insert sensors into soil.</p><img src="https://via.placeholder.com/200x150" alt="Step 1"></div>
        <div class="manual-step"><h3 data-translate="STEP II">STEP II: Calibrate Sensors</h3><p>Adjust settings via the app to calibrate readings.</p><img src="https://via.placeholder.com/200x150" alt="Step 2"></div>
        <div class="manual-step"><h3 data-translate="STEP III">STEP III: Monitor Data</h3><p>View real-time data on the dashboard.</p><img src="https://via.placeholder.com/200x150" alt="Step 3"></div>
      </div>
    </div>
  </div>

  <!-- PDF MODAL -->
  <div class="pdf-modal" id="pdf-modal">
    <div class="pdf-container" id="report-content">
      <button class="close-pdf" id="close-pdf">×</button>
      <div class="pdf-header">
        <h1>Agronomist Soil Report</h1>
        <p id="report-date"></p>
      </div>
      <div class="pdf-section"><h3>Sensor Parameters</h3><div class="pdf-row" id="sensor-rows"></div></div>
      <div class="pdf-section"><h3>Recommendations</h3><div class="pdf-row" id="recommendation-rows"></div></div>
      <div class="pdf-section"><h3>Weather</h3><div class="pdf-row" id="weather-rows"></div></div>
      <button class="download-btn" id="download-pdf">Download PDF</button>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&libraries=maps&v=beta" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAa1vm7ni1EwE4yV78g5ZY52m-COBwh1A8",
      authDomain: "soilparameters.firebaseapp.com",
      databaseURL: "https://soilparameters-default-rtdb.firebaseio.com",
      projectId: "soilparameters",
      storageBucket: "soilparameters.firebasestorage.app",
      messagingSenderId: "372898983262",
      appId: "1:372898983262:web:7e0ca517a932ef0592b3cf"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const sensorRef = ref(db, 'sensor_data');
    const predictionRef = ref(db, 'prediction_data');

    const latest = { sensor: {}, prediction: {}, weatherHTML: '' };

    function updateSensorUI(data) {
      const map = {
        Moisture:      { id:'moisture-value',      perc:'moisture-percentage',      max:100, unit:'%' },
        Temperature:   { id:'temperature-value',   perc:'temperature-percentage',   max:50,  unit:'°C' },
        EC:            { id:'ec-value',            perc:'ec-percentage',            max:20,  unit:'µS/cm' },
        pH:            { id:'ph-value',            perc:'ph-percentage',            max:14,  unit:'' },
        Nitrogen:      { id:'nitrogen-value',      perc:'nitrogen-percentage',      max:50,  unit:'mg/kg' },
        Phosphorous:   { id:'phosphorus-value',    perc:'phosphorus-percentage',    max:50,  unit:'mg/kg' },
        Potassium:     { id:'potassium-value',     perc:'potassium-percentage',     max:50,  unit:'mg/kg' }
      };

      Object.entries(map).forEach(([key, cfg]) => {
        const val = data[key] ?? 0;
        document.getElementById(cfg.id).textContent = `${val} ${cfg.unit}`;
        document.getElementById(cfg.perc).textContent = Math.round(val);
        const circle = document.getElementById(cfg.id).closest('.chart-info-wrapper').nextElementSibling.querySelector('.circle');
        if (circle) {
          const percent = Math.min((val / cfg.max) * 100, 100);
          circle.setAttribute('stroke-dasharray', `${percent},100`);
        }
      });

      const devId = data.DeviceID || 'AGR-001';
      document.getElementById('device-id').textContent = `PRODUCT ID: ${devId}`;
      latest.sensor = data;
    }

    function updatePredictionUI(data) {
      document.getElementById('recommended-crop').textContent = data.Crop || 'N/A';
      document.getElementById('recommended-fertilizer').textContent = data.Fertilizer || 'N/A';
      const soc = data.SOC !== undefined ? data.SOC.toFixed(4) : 'N/A';
      document.getElementById('soc-value').textContent = `${soc} %`;
      document.getElementById('soc-percentage').textContent = soc;
      document.getElementById('texture-value').textContent = data.Texture || 'N/A';
      latest.prediction = data;
    }

    onValue(sensorRef, snap => { const d = snap.val(); if (d) updateSensorUI(d); });
    onValue(predictionRef, snap => { const d = snap.val(); if (d) updatePredictionUI(d); });

    // Weather
    const locEl = document.getElementById('location');
    const weatherEl = document.getElementById('weather');
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const { latitude: lat, longitude: lon } = pos.coords;
        fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=623a2e2f8257c10827ed28570f40a00c`)
          .then(r => r.json())
          .then(d => {
            locEl.textContent = `Location: ${d.name}, ${d.sys.country}`;
            const html = `<p class="w_f">Temperature: ${d.main.temp}°C</p><p class="w_f">Humidity: ${d.main.humidity}%</p><p class="w_f">Clouds: ${d.clouds.all}%</p><p class="w_f">Wind: ${d.wind.speed} m/s</p>`;
            weatherEl.innerHTML = html;
            latest.weatherHTML = html;
          })
          .catch(() => { locEl.textContent = 'Weather unavailable'; });
      }, () => { locEl.textContent = 'Geolocation denied'; });
    }

    // Generate Report Button
    document.getElementById('generate-report-btn').addEventListener('click', () => {
      if (!latest.sensor.DeviceID && !latest.prediction.Crop) {
        alert('Waiting for data…');
        return;
      }
      const date = new Date().toLocaleString();
      document.getElementById('report-date').textContent = `Generated: ${date} | Device: ${latest.sensor.DeviceID || 'N/A'}`;

      const sensorHTML = `
        ${item('moisture.png',      'Moisture',      `${latest.sensor.Moisture ?? 0} %`)}
        ${item('temperature.png',   'Temperature',   `${latest.sensor.Temperature ?? 0} °C`)}
        ${item('conductivity.png',  'EC',            `${latest.sensor.EC ?? 0} µS/cm`)}
        ${item('ph.png',            'pH',            `${latest.sensor.pH ?? 0}`)}
        ${item('nitrogen.png',      'Nitrogen',      `${latest.sensor.Nitrogen ?? 0} mg/kg`)}
        ${item('phosphorus.png',    'Phosphorus',    `${latest.sensor.Phosphorous ?? 0} mg/kg`)}
        ${item('potassium.png',     'Potassium',     `${latest.sensor.Potassium ?? 0} mg/kg`)}
        ${item('SOC.png',           'SOC',           `${(latest.prediction.SOC ?? 0).toFixed(4)} %`)}
        ${item('texture.png',       'Texture',       `${latest.prediction.Texture ?? 'N/A'}`)}
      `;
      document.getElementById('sensor-rows').innerHTML = sensorHTML;

      document.getElementById('recommendation-rows').innerHTML = `
        ${item('crop.png',       'Recommended Crop',       latest.prediction.Crop ?? 'N/A')}
        ${item('fertilizer.png', 'Recommended Fertilizer', latest.prediction.Fertilizer ?? 'N/A')}
      `;

      document.getElementById('weather-rows').innerHTML = `<div class="pdf-item"><span>${latest.weatherHTML || 'No data'}</span></div>`;

      document.getElementById('pdf-modal').classList.add('show');
    });

    function item(icon, label, value) {
      return `<div class="pdf-item"><img src="${icon}" alt="${label}"><div><span>${value}</span><br><small>${label}</small></div></div>`;
    }

  document.getElementById('download-pdf').onclick = () => {
  const mapContainer = document.getElementById('map-container');
  mapContainer.style.display = 'none'; // Hide map to avoid canvas taint

  setTimeout(() => {
    html2pdf()
      .from(document.getElementById('report-content'))
      .set({
        margin: 1,
        filename: `Agronomist_Report_${latest.sensor.DeviceID || 'Unknown'}_${new Date().toISOString().slice(0,10)}.pdf`,
        html2canvas: { scale: 2, useCORS: true, allowTaint: false },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      })
      .save()
      .then(() => {
        mapContainer.style.display = 'block';
        document.getElementById('pdf-modal').classList.remove('show');
      })
      .catch(err => {
        console.error('PDF Error:', err);
        alert('PDF failed. Check console.');
        mapContainer.style.display = 'block';
      });
  }, 500);
};

    // Close modal (still works)
    document.getElementById('close-pdf').onclick = () => {
      document.getElementById('pdf-modal').classList.remove('show');
    };

    // UI Interactions
    document.querySelector('.nav-menu-toggle').onclick = () => document.querySelector('.nav-center').classList.toggle('show');
    document.querySelector('.open-right-area').onclick = () => document.querySelector('.app-right').classList.add('show');
    document.querySelector('.close-right').onclick = () => document.querySelector('.app-right').classList.remove('show');
    document.querySelector('.manual-toggle').onclick = () => document.querySelector('.manual-content').classList.toggle('show');
  </script>

  <!-- TRANSLATIONS -->
  <script>
    const translations = {
      en: {
        "Agronomists": "Agronomists",
        "Dashboard": "Dashboard",
        "Map": "Map",
        "Reports": "Reports",
        "Agronomist Dashboard": "Agronomist Dashboard",
        "Moisture": "Moisture",
        "Temperature": "Temperature",
        "Electrical Conductivity": "Electrical Conductivity",
        "pH Content": "pH Content",
        "Nitrogen": "Nitrogen",
        "Phosphorus": "Phosphorus",
        "Potassium": "Potassium",
        "Soil Organic Carbon": "Soil Organic Carbon",
        "Recommended Crop": "Recommended Crop",
        "Recommended Fertilizer": "Recommended Fertilizer",
        "Soil Texture": "Soil Texture",
        "Weather Information": "Weather Information",
        "PRODUCT ID": "PRODUCT ID",
        "Device Name": "Device Name",
        "STEP I": "STEP I: Setup Device",
        "STEP II": "STEP II: Calibrate Sensors",
        "STEP III": "STEP III: Monitor Data"
      },
      ta: {
        "Agronomists": "வேளாண் வல்லுநர்கள்",
        "Dashboard": "டாஷ்போர்டு",
        "Map": "வரைபடம்",
        "Reports": "அறிக்கைகள்",
        "Agronomist Dashboard": "வேளாண் வல்லுநர் டாஷ்போர்டு",
        "Moisture": "ஈரப்பதம்",
        "Temperature": "வெப்பநிலை",
        "Electrical Conductivity": "மின்சார கடத்துத்திறன்",
        "pH Content": "pH உள்ளடக்கம்",
        "Nitrogen": "நைட்ரஜன்",
        "Phosphorus": "பாஸ்பரஸ்",
        "Potassium": "பொட்டாசியம்",
        "Soil Organic Carbon": "மண் கரிம கார்பன்",
        "Recommended Crop": "பரிந்துரைக்கப்பட்ட பயிர்",
        "Recommended Fertilizer": "பரிந்துரைக்கப்பட்ட உரம்",
        "Soil Texture": "மண் அமைப்பு",
        "Weather Information": "வானிலை தகவல்",
        "PRODUCT ID": "பொருள் அடையாளம்",
        "Device Name": "சாதன பெயர்",
        "STEP I": "படி I: சாதனத்தை அமைக்கவும்",
        "STEP II": "படி II: சென்சார்களை அளவுத்திருத்தம் செய்யவும்",
        "STEP III": "படி III: தரவை கண்காணிக்கவும்"
      },
      hi: {
        "Agronomists": "कृषि वैज्ञानिक",
        "Dashboard": "डैशबोर्ड",
        "Map": "नक्शा",
        "Reports": "रिपोर्ट्स",
        "Agronomist Dashboard": "कृषि वैज्ञानिक डैशबोर्ड",
        "Moisture": "नमी",
        "Temperature": "तापमान",
        "Electrical Conductivity": "विद्युत चालकता",
        "pH Content": "pH सामग्री",
        "Nitrogen": "नाइट्रोजन",
        "Phosphorus": "फॉस्फोरस",
        "Potassium": "पोटैशियम",
        "Soil Organic Carbon": "मिट्टी का कार्बनिक कार्बन",
        "Recommended Crop": "भविष्यवाणी की गई फसल",
        "Recommended Fertilizer": "भविष्यवाणी किया गया उर्वरक",
        "Soil Texture": "मिट्टी की बनावट",
        "Weather Information": "मौसम जानकारी",
        "PRODUCT ID": "उत्पाद आईडी",
        "Device Name": "डिवाइस का नाम",
        "STEP I": "चरण I: डिवाइस सेटअप करें",
        "STEP II": "चरण II: सेंसर कैलिब्रेट करें",
        "STEP III": "चरण III: डेटा मॉनिटर करें"
      }
    };

    document.getElementById('language').onchange = e => {
      const lang = e.target.value;
      document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        el.textContent = translations[lang][key] || el.textContent;
      });
    };
  </script>
</body>
</html>
